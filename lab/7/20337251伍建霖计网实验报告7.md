# 计算机网络 · 实验7报告

20337251 伍建霖

## 1. 实验目的

​	1. 掌握在路由器和交换机上配置 RIPv2，并能够比较与 RIPv1 的不同。

​	2. 通过 WireShark 抓包，理解 RIPv2 在正常情况下的报文和异常情况下毒性反转的机制。

​	3. 通过 debug 技术，了解 RIP 的工作状态。

## 2. 实验内容

1. 在实验设备上完成P243实验7-2并测试实验网连通性。

2. 通过实验观察RIP V1 和 V2的区别（重点在VLSM上）给出分析过程与结果（实验IP采用10.10.x.0网段）

3. 学会使用Debug ip packet和Debug ip rip 命令，并对debug信息做分析。

4. 观察试验拓扑中链路状态发生改变时路由表的前后信息对比及debug信息的变化。

## 3. 实验记录

### 一、在192.168.x.0网段，RIPv2下完成实验7-2

#### 1. 连线

按照下列所述配置IP地址，子网掩码和默认网关：

PC1 192.168.5.11 255.255.255.0 192.168.5.1

PC2 192.168.3.22 255.255.255.0 192.168.3.1

连好后尝试PC1 ping PC2，ping不通。

<img src="D:\CodeField\TyporaPicture\微信图片_202210150045460.png" alt="微信图片_202210150045460" style="zoom:95%;" />

​																				（PC1 ping PC2 结果）

路由器1的路由表如下：

<img src="D:\CodeField\TyporaPicture\微信图片2.png" alt="微信图片2" style="zoom:80%;" />

#### 2. 配置

按照书上P244和P245步骤2到步骤7配置交换机和路由器。

<img src="D:\CodeField\TyporaPicture\image-20221015130353768.png" alt="image-20221015130353768" style="zoom:100%;" />

​													（交换机配置好后的情况）

<img src="D:\CodeField\TyporaPicture\image-20221015130422886.png" alt="image-20221015130422886" style="zoom:100%;" />

​													（路由器1配置好后的情况）

<img src="D:\CodeField\TyporaPicture\image-20221015130500855.png" alt="image-20221015130500855" style="zoom:80%;" />

​													（路由器2配置好后的情况）

可以看到三台机器中的路由表都含有 R 条目。交换机可以通过路由器 R1 的 RIP 包得知去 192.168.2.0 和 192.168.3.0 的路径。同理，两台路由器也可以通过学习得知发到其他网段的路由信息。

#### 3. 测试连通性

##### 比较路由表

将现在的路由表和步骤1中的路由表对比，可以发现现在的路由表多了端口绑定的网段信息以及 RIP 路由协议自动学习生成出来的动态路由表。

##### tracert情况

PC2 ping PC1情况如下：

<img src="D:\CodeField\TyporaPicture\image-20221015130953393.png" alt="image-20221015130953393" style="zoom:80%;" />

可以看到包从PC2到了路由器2，再到了路由器1，最后到PC1。

##### 观察毒性反转

输入命令ping 192.168.5.11 -t后，wireshark抓包如下：

<img src="D:\CodeField\TyporaPicture\image-20221015131611735.png" alt="image-20221015131611735" style="zoom:80%;" />

​																	（毒性反转现象）

<img src="D:\CodeField\TyporaPicture\image-20221015131628588.png" alt="image-20221015131628588" style="zoom:80%;" />

​																	（正常的包）

<img src="D:\CodeField\TyporaPicture\image-20221015132103165.png" alt="image-20221015132103165" style="zoom:80%;" />

​																	（从PC1上抓包）

可以看到毒性反转的包中的跳数Metric为16，表示无限大；而正常的包跳数为3。

同时可以看到RIP协议会每隔30秒向外发送一次更新报文。而且从PC1和PC2上都能抓到包。

### 二、在10.10.x.0网段，RIPv2下完成实验7-2

#### 1. 连线

按照下列所述配置IP地址，子网掩码和默认网关：

PC1 10.10.5.11 255.255.255.0 10.10.5.1

PC2 10.10.3.22 255.255.255.0 10.10.3.1

同样ping不通。

#### 2. 配置

仿照书上P244和P245步骤2到步骤7配置交换机和路由器。

将10.10.2.0相关的子网掩码设为255.255.255.252，以便测试RIPv2是否支持不连续网段。

<img src="D:\CodeField\TyporaPicture\image-20221015133052779.png" alt="image-20221015133052779" style="zoom:100%;" />

<img src="D:\CodeField\TyporaPicture\image-20221015133158162.png" alt="image-20221015133158162" style="zoom:80%;" />

​																	（交换机配置好后的情况）

<img src="D:\CodeField\TyporaPicture\image-20221015133113385.png" alt="image-20221015133113385" style="zoom:100%;" />

<img src="D:\CodeField\TyporaPicture\image-20221015133238840.png" alt="image-20221015133238840" style="zoom:80%;" />

​																	（路由器1配置好后的情况）

<img src="D:\CodeField\TyporaPicture\image-20221015133411989.png" alt="image-20221015133411989" style="zoom:70%;" />

<img src="D:\CodeField\TyporaPicture\image-20221015133342377.png" alt="image-20221015133342377" style="zoom:60%;" />

​																	（路由器2配置好后的情况）

#### 3. 测试连通性

##### tracert情况

<img src="D:\CodeField\TyporaPicture\image-20221015134109113.png" alt="image-20221015134109113" style="zoom:80%;" />

##### 观察毒性反转

同上个实验结果。

### 三、在10.10.x.0网段，RIPv1下完成实验7-2

#### 1. 连线

按照下列所述配置IP地址，子网掩码和默认网关：

PC1 10.10.5.11 255.255.255.0 10.10.5.1

PC2 10.10.3.22 255.255.255.0 10.10.3.1

同样ping不通。

#### 2. 配置

仿照书上P244和P245步骤2到步骤7配置交换机和路由器。

将10.10.2.0相关的子网掩码设为255.255.255.252，以便测试RIPv1是否支持不连续网段。

同时不要输入no auto-summary命令。

<img src="D:\CodeField\TyporaPicture\image-20221015134816041.png" alt="image-20221015134816041" style="zoom:80%;" />

<img src="D:\CodeField\TyporaPicture\image-20221015134858192.png" alt="image-20221015134858192" style="zoom:80%;" />

​																	（交换机配置好后的情况）

<img src="D:\CodeField\TyporaPicture\image-20221015134837036.png" alt="image-20221015134837036" style="zoom:80%;" />

<img src="D:\CodeField\TyporaPicture\image-20221015134919279.png" alt="image-20221015134919279" style="zoom:80%;" />

​																	（路由器1配置好后的情况）

<img src="D:\CodeField\TyporaPicture\image-20221015134736152.png" alt="image-20221015134736152" style="zoom:80%;" />

​																	（路由器2配置好后的情况）

#### 3. 测试连通性

##### tracert情况

从下面截图可看出PC1无法ping通PC2。

根据书上关于RIP的资料所述，如果需要 ping 通，则需要更改子网掩码均为 255.255.255.0，同时需要开启自动汇总。

<img src="D:\CodeField\TyporaPicture\image-20221015135200524.png" alt="image-20221015135200524" style="zoom:80%;" />

##### 观察毒性反转

通过wireshark抓到RIP正常的包如下：

<img src="D:\CodeField\TyporaPicture\image-20221015135250624.png" alt="image-20221015135250624" style="zoom:80%;" />

## 4. 实验思考

### 查看交换机端口 0/1 所属的 VLAN 应当使用哪条命令?

config下show vlan。

### 如何查看 RIP 版本号和发布到的网段？

config下show ip protocols。

### RIPv1 的广播地址和RIPv2 的组播地址？

RIPv1 的广播地址是 255.255.255.255，RIPv2 的组播地址是 224.0.0.9。

### 在实验三中，路由器对两个子网掩码的配置分别为 24 位和 30 位。最后路由器的可变子网掩码中，被统一为 30 位。

<img src="D:\CodeField\TyporaPicture\image-20221015140616965.png" alt="image-20221015140616965" style="zoom:120%;" />

#### RIPv1 必须使用路由自动汇总，不支持不连续网络。RIPv2 支持不连续的网络吗？

RIPv1 必须使用路由自动汇总，不支持不连续网络。RIPv2 必须关闭路由自动汇总才能支持不连续网络，否则不支持。具体截图见上述实验步骤。

#### RIPv1 对路由没有标记的功能，RIPv2 可以对路由打标记（tag），用于过滤和做策略。

<img src="D:\CodeField\TyporaPicture\image-20221015140814163.png" alt="image-20221015140814163" style="zoom:80%;" />

​																			（RIPv1的包）

<img src="D:\CodeField\TyporaPicture\image-20221015140840342.png" alt="image-20221015140840342" style="zoom:80%;" />

​																				（RIPv2的包）

由截图可以知道RIPv1中找不到 Tag 项，而在 RIPv2 中，可以找 到 Tag 项。

### RIPv1和RIPv2区别

RIPv1 支持有类地址，不支持 VLSM，不会在路由信息中发送子网掩码，因此学习到的路由的子网掩码是由接收端口所处的网段决定的。

RIPv2 支持无类地址，支持 VLSM 发送信息中包括子网掩码。

<img src="D:\CodeField\TyporaPicture\image-20221015140814163.png" alt="image-20221015140814163" style="zoom:80%;" />

​																				（RIPv1的包）

<img src="D:\CodeField\TyporaPicture\image-20221015140840342.png" alt="image-20221015140840342" style="zoom:80%;" />

​																				（RIPv2的包）

### Debug

使用 debug ip rip，可以实时的显示发送以及接收到的路由信息。显示的信息包括：RIP 报文所在的 IP 报文的源地址和目的地址，RIP 报文所在的 UDP 报文的源端口号和目的端口号，RIP 报文头的内容

<img src="D:\CodeField\TyporaPicture\image-20221015141400789.png" alt="image-20221015141400789" style="zoom:200%;" />

​																				（拔线前后RIP包情况）

<img src="D:\CodeField\TyporaPicture\image-20221015141437477.png" alt="image-20221015141437477" style="zoom:200%;" />

​																				（定时器清零前后RIP包情况）

<img src="D:\CodeField\TyporaPicture\image-20221015141507509.png" alt="image-20221015141507509" style="zoom:200%;" />

​																					（正常RIP包情况）
