# 计算机网络 · 实验3报告

20337251 伍建霖

## 1. 实验目的

​	理解快速生成树协议的配置及原理。使网络在有冗余链路的情况下避免环路的产生，避免广播风暴等。

## 2. 实验内容

(1)完成实验教程实例6-8的实验，回答实验提出的问题及实验思考。（P204）

(2)抓取生成树协议数据包，分析桥协议数据单元（BPDU）。

(3)在实验设备上查看VLAN生成树，并学会查看其它相关重要信息。

## 3. 实验6-8 快速生成树协议配置

### 1. 为PC1和PC2配置IP地址和掩码，观察配置前的情况

​	用网线连接设备，从控制界面设置实验网IP地址和掩码，并打开wireshark准备抓包观察。

​	观察配置前情况，下图查看了交换机的生成树配置信息，显示No spanning tree instance exists。

<img src="D:\CodeField\TyporaPicture\IMG_3780.JPG" alt="IMG_3780" style="zoom:15%;" />

​	在没有主动通信且没有生成树配置的情况下，从wireshark能观察到广播风暴，下图右下角显示抓到3262119个包并已卡死。<img src="D:\CodeField\TyporaPicture\IMG_3778.JPG" alt="IMG_3778" style="zoom:80%;" />

​	测试下面两种情况：PC1 ping PC2和PC1 ping 其他IP 发现ping其他IP的包增长的更快（虽然说wireshark都已经卡死了）。

​	在测试的时候show mac-address-table发现mac地址对应的端口时不时会发生变化，从网上找资料说是多帧复制和MAC地址表不稳定现象。

### 2. 拔下端口2的网线，并设置交换机A和交换机B的端口和生成树

​	像上次的实验6-2一样，将端口1设置为access，端口2和端口3设置为trunk。设置好后show vlan id查看，确认一下。设置spanning tree，指定为RSTP类型

### 3. 重做步骤1

​	输入命令show spanning-tree，显示下图

<img src="D:\CodeField\TyporaPicture\IMG_3785.JPG" alt="IMG_3785" style="zoom:80%;" />

​	用wireshark抓包发现不再出现广播风暴。

​	PC1 ping PC2和PC1 ping 其他IP ，包增长的都不快，没出现广播风暴，没有PC死锁。

### 4. 验证测试，观察端口和交换机状态

​	下面两图表示switchA的端口1处于forwarding状态且switchA为非根交换机，端口2的状态为discarding。

<img src="D:\CodeField\TyporaPicture\IMG_3791.JPG" alt="IMG_3791" style="zoom:80%;" />

<img src="D:\CodeField\TyporaPicture\IMG_3790.JPG" alt="IMG_3790" style="zoom:80%;" />

​	由下图可知根端口为端口1，根交换机为switchB

<img src="D:\CodeField\TyporaPicture\IMG_3792.JPG" alt="IMG_3792" style="zoom:80%;" />

<img src="D:\CodeField\TyporaPicture\IMG_3793.JPG" alt="IMG_3793" style="zoom:80%;" />

### 5. 设置交换机A的优先级并验证

​	由下图可见将交换机A的优先级设为4096后，根交换机变成交换机A了。

<img src="D:\CodeField\TyporaPicture\IMG_3799.JPG" alt="IMG_3799" style="zoom:80%;" />

### 6. 观察交换机B端口的状态

​	端口状态未变化。

<img src="D:\CodeField\TyporaPicture\IMG_3800.JPG" alt="IMG_3800" style="zoom:80%;" />

<img src="D:\CodeField\TyporaPicture\IMG_3801.JPG" alt="IMG_3801" style="zoom:80%;" />

### 7. down掉端口1的链路

​	down掉端口1后show spanning tree显示已启用端口2。

<img src="D:\CodeField\TyporaPicture\微信图片_20220924105843.png" alt="微信图片_20220924105843" style="zoom:50%;" />

### 8. down掉之后，ping的情况

​	down掉之后短暂掉线，然后可恢复通信。

<img src="D:\CodeField\TyporaPicture\微信图片_20220924105852.png" alt="微信图片_20220924105852" style="zoom:50%;" />

​	由下图可知down掉后启用了端口2。

<img src="D:\CodeField\TyporaPicture\微信图片_20220924105857.png" alt="微信图片_20220924105857" style="zoom:50%;" />

### 9. wireshark分析

<img src="D:\CodeField\TyporaPicture\微信图片_20220924105900.png" alt="微信图片_20220924105900" style="zoom:50%;" />

## 4. 实验思考

### 是否有环路

​	有环路，出现了广播风暴。若要避免，可配置生成树。

### 冗余链路是否出现MAC地址表不稳定和多帧复制的情况

​	出现了。

### 改为STP

​	改为STP后，恢复连接的时间变长了不少。

<img src="D:\CodeField\TyporaPicture\微信图片_20220924105904.png" alt="微信图片_20220924105904" style="zoom:50%;" />

### 一根跳线变两根跳线

​	恢复连接后会出现广播风暴。

<img src="D:\CodeField\TyporaPicture\微信图片_20220924105907.png" alt="微信图片_20220924105907" style="zoom:50%;" />

