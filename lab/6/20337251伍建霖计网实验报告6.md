# 计算机网络 · 实验6报告

20337251 伍建霖

## 1. 实验目的

掌握静态路由的配置和使用方法，熟悉交换机端口镜像的方法以及如何用于监视端口。

## 2. 实验内容

（1）阅读教材P190-192关于端口镜像的内容

（2）阅读教材P233实例7-1

（3）阅读教材P29，熟悉Packet Tracer使用实例

（4）完成教材P273习题15

## 3. 实验记录

### 一、端口镜像命令

配置端口镜像的方法：

1. 配置源端口和配置目的端口(目的端口即作为镜像的端口)：

​	Switch(config)# monitor session session_number source/destination(源or目的) interface type interface-id [rx/tx/both]

2. 取消端口镜像：no monitor session session_number/all

3. 查看镜像配置：show monitor

### 二、配置路由命令

静态路由：由管理员创建和维护的固定路由表。

1. 三种接口：局域网接口，广域网接口，配置接口

2. 为路由器设置一条路由条目，里面需要包含的信息：目的IP地址、其子网掩码、下一跳地址、转发端口

3. 路由遵循匹配原则和最长前缀原则

配置静态路由的方法：

1. 路由器上查看路由表信息：show ip route；PC命令行查看路由表信息：route print

2. 进入路由器指定端口进行配置

3. 配置端口ip并开启该端口：

​      ip address 网段 子网掩码

​      no shutdown

4. 配置静态路由：ip route 目的ip 子网掩码 下一跳路由ip

### 三、习题15

#### 1. 连接

按照拓扑图连线即可。

<img src="D:\CodeField\TyporaPicture\clip_image002.png" alt="img" style="zoom:80%;" />

实际连线如下。

<img src="D:\CodeField\TyporaPicture\微信图片_20221010122444.jpg" alt="微信图片_20221010122444" style="zoom:10%;" />

#### 2. 记录路由表

输入show ip route即可显示路由表。

![img](D:\CodeField\TyporaPicture\clip_image002-16653764150323.png)

​																			（路由器1）

![img](D:\CodeField\TyporaPicture\clip_image004.png)

​																			（路由器2）

#### 3. PC1pingPC2，查看交换机MAC地址表

在配置了两台路由器的路由表之后可以ping通。

![img](D:\CodeField\TyporaPicture\clip_image002-16653766065096.png)

第一次ping通的时候查看mac地址表有三条，分别是0/1，0/2，0/24的。但不知道为什么第二次ping就只有0/24的了。

<img src="D:\CodeField\TyporaPicture\微信图片_20221010122437.jpg" alt="微信图片_20221010122437" style="zoom:20%;" />

#### 4. 清除MAC地址表，PC1pingPC2，PC3使用wireshark抓包，记录交换机MAC地址表

输入clear mac-address-table dynamic即可清除MAC地址表。但在PC3上依旧抓不到包。MAC地址表如下。

<img src="D:\CodeField\TyporaPicture\微信图片_20221010122441.jpg" alt="微信图片_20221010122441" style="zoom:25%;" />

#### 5. 重启wireshark进行抓包，记录PC1的ARP缓冲区

重启后wireshark依旧抓不到包，这里我记录成PC2的arp缓冲区了。

<img src="D:\CodeField\TyporaPicture\微信图片_20221010122350.jpg" alt="微信图片_20221010122350" style="zoom:15%;" />

<img src="D:\CodeField\TyporaPicture\微信图片_20221010122008.png" alt="微信图片_20221010122008" style="zoom:95%;" />

#### 6. 镜像交换机端口，尝试抓包，查看MAC地址表

将交换机端口0/2镜像到端口0/24后，在PC3上依旧无法抓到PC1pingPC2的包。

抓包失败太多次了，我用tracert验证了一下我的想法，包从PC1到路由器1到路由器2到PC2，并没有经过交换机，所以PC3抓不到包。

<img src="D:\CodeField\TyporaPicture\微信图片_20221010122449.jpg" alt="微信图片_20221010122449" style="zoom:20%;" />

​																		（端口镜像配置后结果）

#### 7. PC1运行命令ping -r 6 -l 200 192.168.3.22和ping -s 4 -l 200 192.168.3.22，PC3尝试抓包

由于路由表正常，路由器1和路由器2也连接正常，所以我猜测PC3依旧抓不到包。结果也确实如此。

#### 8. 删除路由器1的静态路由，默认路由指向路由器2的以太网端口，PC1pingPC2，PC3尝试抓包

​    每次PC3只捕捉到了四个从PC1发送到PC2的包，但是没有检测到PC2返回给PC1的数据包，并且此时，PC1 ping不通PC2，原因如下：当静态路断开后，此时默认路由会把PC1发到路由器1的ICMP包发给交换机，一旦发到交换机，PC3根据端口镜像捕获到ICMP包，故有Wireshark截屏得到的四个echo请求包。

​    紧接着，交换机会把ICMP包发送给PC2，即PC2包的确接收到数据包的，PC2准备发送echo相应包给PC1，但是由于静态链路已经断开，又没有设置默认路由，包会停留在路由器2而不再往前发送，自然不经过交换机，PC3检测不到echo响应包，PC1由于收不到ICMP返回包，显示ping不通。

![img](D:\CodeField\TyporaPicture\clip_image002-166537855948015.png)

​																		（路由器1配置过程）

<img src="D:\CodeField\TyporaPicture\clip_image010.png" alt="img" style="zoom:150%;" />

​																		（ICMP包局部信息）

#### 9. 删除路由器2的静态路由，默认路由指向路由器1的以太网端口，PC1pingPC2，PC3尝试抓包

​	此时ICMP请求响应包都能成功通过交换机向另一台PC转发，因此端口镜像PC3可以捕获到ping过程的所有八个包，在抓包过程中没有捕获到ARP包，但ARP在接线的时候有出现过广播的ARP包。

![img](D:\CodeField\TyporaPicture\clip_image002-166537885587427.png)

​																			（路由器2配置过程）

![img](D:\CodeField\TyporaPicture\clip_image004-166537885587531.png)

![img](D:\CodeField\TyporaPicture\clip_image006-166537885587529.png)

​																				（ping截屏）

![img](D:\CodeField\TyporaPicture\clip_image008-166537885587530.png)

​											（PC1pingPC2通，检测到ICMP echo请求包和响应包）

#### 10. PC1ping一个本拓扑结构外的IP，观察情况

并不能ping通，因为默认路由指向路由器2的以太网接口，包将在本次实验的局域网内广播，故wireshark能抓到echo请求包。
