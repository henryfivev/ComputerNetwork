# 计算机网络 · 实验8报告

20337251 伍建霖

## 1. 实验目的

掌握OSPF协议单区域的配置和使用方法。

## 2. 实验内容

(1)  完成路由器配置实验实例7-3（P252）的“OSPF单区域配置”，回答步骤1、步骤9问题。

(2)  在（1）的基础上每台路由器上各加入一台电脑，画出新拓扑，然后：

​	(a)    检查任意两个PC之间是否可以Ping通，对一台主机ping其它主机的结果进行截屏。

​	(b)    采用#depug ip ospf显示上面OSPF协议的运行情况，观察并保存R1发送和接收的Update分组(可以改变链路状态来触发)，注意其中LSA类型；观察有无224.0.0.5、224.0.0.6 IP地址，如有说明这两地址的作用。

​	(c)    显示并记录路由器R1数据库的Router LSA，Network LSA，LS数据库信息汇总

  **#** **show ip ospf database router**       ！ 显示router LSA

  **#** **show ip ospf database network**      ！显示network LSA

  **# show ip ospf database database**     ！显示OSPF 链路状态数据库信息。

​	(d)    显示并记录邻居状态。

  **# show ip ospf neighbor**

​	(e)    显示并记录R1的所有接口信息

  **# show ip ospf interface [接口名]**

## 3. 实验记录

### 实验7-3

#### 1. 配置PC1和PC2（步骤1）

**![img](D:\CodeField\TyporaPicture\clip_image002-16663406467761.png)**

按照书上的拓扑图配置PC1和PC2。此时PC2无法ping通PC1。

<img src="D:\CodeField\TyporaPicture\image-20221021162553014.png" alt="image-20221021162553014" style="zoom:80%;" />

​														（PC2 ping PC1结果）

<img src="D:\CodeField\TyporaPicture\image-20221021162650656.png" alt="image-20221021162650656" style="zoom:80%;" />

​														（R2 show ip route结果）

#### 2. 配置交换机和路由器（步骤2到8）

按照书上的命令分别配置端口和OSPF协议，结果如下：

<img src="D:\CodeField\TyporaPicture\image-20221021163422702.png" alt="image-20221021163422702" style="zoom:110%;" />

​														（交换机的端口配置结果）

<img src="D:\CodeField\TyporaPicture\image-20221021163459359.png" alt="image-20221021163459359" style="zoom:80%;" />

​														（路由器1的端口配置结果）

<img src="D:\CodeField\TyporaPicture\image-20221021162925548.png" alt="image-20221021162925548" style="zoom:80%;" />

​														（路由器2的端口配置结果）

<img src="D:\CodeField\TyporaPicture\image-20221021163722683.png" alt="image-20221021163722683" style="zoom:90%;" />

​															（交换机的OSPF配置结果）

<img src="D:\CodeField\TyporaPicture\image-20221021163815612.png" alt="image-20221021163815612" style="zoom:90%;" />

​															（路由器1的OSPF配置结果）

<img src="D:\CodeField\TyporaPicture\image-20221021163021672.png" alt="image-20221021163021672" style="zoom:100%;" />

​															（路由器2的OSPF配置结果）

从上面的OSPF配置结果可以看到每台机器的路由表都多了两条OSPF路由条目，内容是另外两台机器连接的网段，这是OSPF自动学习获得的，就如上次的RIP一样。

#### 3. 测试连通性（步骤9）

##### tracert结果

<img src="D:\CodeField\TyporaPicture\image-20221021164754479.png" alt="image-20221021164754479" style="zoom:100%;" />

​																		（ping 和 tracert 结果）

从上面的截图可以看出包从PC2的 .3.22 ，到路由器2的 .3.1，到路由器2的 .2.1，到交换机上的 .1.2，最后到 PC1的 .5.11。

##### wireshark抓包

PC1和PC2都能抓到OSPF的Hello包，内容如下：

<img src="D:\CodeField\TyporaPicture\image-20221021170449187.png" alt="image-20221021170449187" style="zoom:50%;" />

​																			（PC1抓到的包）

<img src="D:\CodeField\TyporaPicture\image-20221021165443798.png" alt="image-20221021165443798" style="zoom:80%;" />

​																		（PC2抓到的Hello包的内容）

包内容分析：该OSPF由一个Header首部和Message（HelloPacket）组成，是一个多播报文（目的IP为224.0.0.5）首部包含Message类型（1），和源路由器ID（Source OSPF Router：192.168.3.1），Hello Packet包含网络掩码、路由器优先级、生存周期、DR、BDR等信息。该包反应DR为192.168.3.1，BDR还未选出（为0.0.0.0）。

##### debug ip ospf

从上述Wireshark截屏也可以看出，我们捕获到了发往224.0.0.5的包，但没有捕获到发往224.0.0.6的包。

224.0.0.6指代一个多路访问网络中DR和BDR的组播接收地址，224.0.0.5指代在任意网络中所有运行OSPF进程的接口都属于该组，于是接收所有224.0.0.5的组播数据包。当OSPF路由器要发报文给所有路由器时，目的IP，就填入：224.0.0.5。当OSPF路由器要发送报文给DR、BDR的时候，目的IP地址就填入：224.0.0.6。224.0.0.5的组播地址为OSPF所有设备的预留IP组播地址；224.0.0.6的组播地址为OSPF DR/BDR的预留IP组播地址。

下面是debug ip ospf运行截图，我们在测试时进行了拔线处理以该改变链路状态。

显示连接断开，NSM做出相应操作的信息。

<img src="D:\CodeField\TyporaPicture\image-20221021170905444.png" alt="image-20221021170905444" style="zoom:80%;" />

​																	（链路断开的信息）

Update分组的首部，包含更新内容。

<img src="D:\CodeField\TyporaPicture\image-20221021171047221.png" alt="image-20221021171047221" style="zoom:80%;" />

​																	（Update分组信息）

##### DR和BDR

通过前面Wireshark捕获截图，我们从数据包中发现192.168.3.1是DR，BDR一项上写为了0.0.0.0，说明未被特殊指定。在OSPF中，DR是必须有的，但BDR是可以没有的。在这个实验中，由于只有一条链路且没有可以选择的备用路由器，因此是没有BDR的。

DR即指定路由，其负责在MA网络建立和维护邻接关系并负责LSA的同步，DR与其他所有的路由器形成邻接关系并交换链路状态信息，其他路由器之间不直接交换链路状态信息，这样就大大减少了MA网络中的邻接关系数据及交换链路状态信息消耗的资源。DR一旦出现故障，其与其他路由器之间的邻接关系将全部失效，链路状态数据库也无法同步，此时就需要重新选举DR、再与非DR路由器建立邻接关系，完成LSA的同步，为了规避单点故障风险，通过选举备份指定路由器BDR，在DR失效时快速接管DR的工作。

DR与BDR的选举规则：DR/BDR的选举是基于接口的，接口的DR优先级越大越优先。接口的DR优先级相等时，router ID越大越优先。接口DR优先级相等时，router ID越大越优先，接口DR优先级为0，表示不参与选举。默认情况下，OSPF进行DR选举时的优先级默认为1，正如我们在Wireshark抓包里所观察到的。

### 实验7-3+加两台电脑

#### 1. 配置两台PC

<img src="D:\CodeField\TyporaPicture\clip_image002-16663443847423.png" alt="img" style="zoom:100%;" />

按照拓扑图设置PC3和PC4，IP地址分别为.6.33和.7.44

#### 2. 配置路由器

仿照书上的命令分别配置端口和OSPF协议，结果如下：

<img src="D:\CodeField\TyporaPicture\image-20221021173352951.png" alt="image-20221021173352951" style="zoom:80%;" />

​																	（路由器2的端口信息）

<img src="D:\CodeField\TyporaPicture\image-20221021173543573.png" alt="image-20221021173543573" style="zoom:80%;" />

​																	（路由器1的端口信息）

<img src="D:\CodeField\TyporaPicture\image-20221021173322823.png" alt="image-20221021173322823" style="zoom:80%;" />

​																（路由器2的OSPF配置信息）

<img src="D:\CodeField\TyporaPicture\image-20221021173621643.png" alt="image-20221021173621643" style="zoom:100%;" />

​																（路由器1的OSPF配置信息）

#### 3. ping结果

四台PC之间都能ping通，结果如下：

<img src="D:\CodeField\TyporaPicture\clip_image002-16663451327271.png" alt="img" style="zoom:100%;" />

#### 4. debug ip ospf

在添加了两台PC后依旧只出现224.0.0.5而没有出现224.0.0.6。

<img src="D:\CodeField\TyporaPicture\image-20221021174039588.png" alt="image-20221021174039588" style="zoom:150%;" />

#### 5. router LSA，network LSA和LSDB

Router LSA信息：这里会显示出与路由器R1有关的OSPF信息。可以看到这里的链路状态id为路由器的标识符。此外还可以看到四条链路，包括连接主机的静态链路，包括路由器内的端口转换的链路，包括和其它路由器之间的链路。

<img src="D:\CodeField\TyporaPicture\image-20221021174112787.png" alt="image-20221021174112787" style="zoom:100%;" />

​																			（router LSA）

Network LSA信息：这里会相对简略的显示链路中所有的路由器的信息，其中Attached Router表示的是路由器的唯一标识符。

<img src="D:\CodeField\TyporaPicture\image-20221021174258976.png" alt="image-20221021174258976" style="zoom:100%;" />

​																			（network LSA）

LS数据库信息：这里显示的只是数目，包括路由链路状态的数目、网络链路状态和总LSA的数目等。

<img src="D:\CodeField\TyporaPicture\image-20221021174328140.png" alt="image-20221021174328140" style="zoom:110%;" />

​																				（LSDB）

#### 6. 邻居状态

<img src="D:\CodeField\TyporaPicture\image-20221021174355056.png" alt="image-20221021174355056" style="zoom:100%;" />

#### 7. R2接口信息

<img src="D:\CodeField\TyporaPicture\image-20221021174419890.png" alt="image-20221021174419890" style="zoom:80%;" />

## 4. 实验思考

### 查看OSPF协议发布的网段

ip ospf database router命令输出的信息中有OSPF发布的网段。

<img src="D:\CodeField\TyporaPicture\image-20221021172453233.png" alt="image-20221021172453233" style="zoom:120%;" />

### 反掩码

子网掩码+反掩码 = 255.255.255.255

## 5. 实验遇到的问题

### 使用自己的笔记本连接后无法ping通

通过tracert和wireshark抓包后分析，认为是因为防火墙的问题，能收到request包，但无法response。

<img src="D:\CodeField\TyporaPicture\IMG_4033.PNG" alt="IMG_4033" style="zoom:20%;" />
